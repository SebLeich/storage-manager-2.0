<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>storage-manager documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">storage-manager documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Injectables</li>
  <li >ProcessBuilderComponentService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/lib/process-builder/components/process-builder/process-builder-component.service.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#paramEditorDialogResultReceived$" >paramEditorDialogResultReceived$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#taskEditingDialogResultReceived$" >taskEditingDialogResultReceived$</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#_appendSequenceFlowEndEvent" >_appendSequenceFlowEndEvent</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_applyConnectorDefaultLabels" >_applyConnectorDefaultLabels</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#_applyFunctionConfiguration" >_applyFunctionConfiguration</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#_extractInputParams" >_extractInputParams</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_handleDataInputConfiguration" >_handleDataInputConfiguration</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_handleErrorGatewayConfiguration" >_handleErrorGatewayConfiguration</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#_handleFunctionOutputParam" >_handleFunctionOutputParam</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_handleNoFunctionSelected" >_handleNoFunctionSelected</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#_methodEvaluationTypeToOutputType" >_methodEvaluationTypeToOutputType</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#_outputParamInterface" >_outputParamInterface</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#_outputParamValue" >_outputParamValue</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_removeActivityWhenNoFunctionIsReferenced" >_removeActivityWhenNoFunctionIsReferenced</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_updateBpmnModelElementActivityIdentifier" >_updateBpmnModelElementActivityIdentifier</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#applyTaskCreationConfig" >applyTaskCreationConfig</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#tryDeleteErrorGateway" >tryDeleteErrorGateway</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#tryDeleteFunction" >tryDeleteFunction</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(_bpmnJs: <a href="../interfaces/IBpmnJS.html" target="_self">IBpmnJS</a>, _config: <a href="../interfaces/IProcessBuilderConfig.html" target="_self">IProcessBuilderConfig</a>, _dialogService: <a href="../injectables/DialogService.html" target="_self">DialogService</a>, _bpmnJsService: <a href="../injectables/BpmnJsService.html" target="_self">BpmnJsService</a>, _store: Store, _confirmationService: <a href="../injectables/ConfirmationService.html" target="_self">ConfirmationService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="61" class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:61</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>_bpmnJs</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/IBpmnJS.html" target="_self" >IBpmnJS</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>_config</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/IProcessBuilderConfig.html" target="_self" >IProcessBuilderConfig</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>_dialogService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/DialogService.html" target="_self" >DialogService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>_bpmnJsService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/BpmnJsService.html" target="_self" >BpmnJsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>_store</td>
                                                  
                                                        <td>
                                                                    <code>Store</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>_confirmationService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/ConfirmationService.html" target="_self" >ConfirmationService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_appendSequenceFlowEndEvent"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>_appendSequenceFlowEndEvent</b></span>
                        <a href="#_appendSequenceFlowEndEvent"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_appendSequenceFlowEndEvent(taskCreationPayload: <a href="../interfaces/ITaskCreationPayload.html" target="_self">ITaskCreationPayload</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="299"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:299</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>taskCreationPayload</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationPayload.html" target="_self" >ITaskCreationPayload</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_applyConnectorDefaultLabels"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>_applyConnectorDefaultLabels</b></span>
                        <a href="#_applyConnectorDefaultLabels"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_applyConnectorDefaultLabels(connector: <a href="../interfaces/IConnector.html" target="_self">IConnector</a>, taskCreationData: <a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self">ITaskCreationFormGroupValue</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="258"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:258</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>connector</td>
                                    <td>
                                                <code><a href="../interfaces/IConnector.html" target="_self" >IConnector</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>taskCreationData</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self" >ITaskCreationFormGroupValue</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_applyFunctionConfiguration"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>_applyFunctionConfiguration</b></span>
                        <a href="#_applyFunctionConfiguration"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_applyFunctionConfiguration(taskCreationData: <a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self">ITaskCreationFormGroupValue</a>, referencedFunction: <a href="../interfaces/IFunction.html" target="_self">IFunction</a>, methodEvaluation: <a href="../interfaces/IMethodEvaluationResult.html" target="_self">IMethodEvaluationResult</a>, outputParamId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="276"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:276</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>taskCreationData</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self" >ITaskCreationFormGroupValue</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>referencedFunction</td>
                                    <td>
                                                <code><a href="../interfaces/IFunction.html" target="_self" >IFunction</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>methodEvaluation</td>
                                    <td>
                                                <code><a href="../interfaces/IMethodEvaluationResult.html" target="_self" >IMethodEvaluationResult</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>outputParamId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_extractInputParams"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>_extractInputParams</b></span>
                        <a href="#_extractInputParams"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_extractInputParams(taskCreationData: <a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self">ITaskCreationFormGroupValue</a>, referencedFunction: <a href="../interfaces/IFunction.html" target="_self">IFunction</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="309"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:309</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>taskCreationData</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self" >ITaskCreationFormGroupValue</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>referencedFunction</td>
                                    <td>
                                                <code><a href="../interfaces/IFunction.html" target="_self" >IFunction</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/IInputParam.html" target="_self" >Promise&lt;IInputParam[]&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_handleDataInputConfiguration"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>_handleDataInputConfiguration</b></span>
                        <a href="#_handleDataInputConfiguration"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_handleDataInputConfiguration(taskCreationData: <a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self">ITaskCreationFormGroupValue</a>, taskCreationPayload: <a href="../interfaces/ITaskCreationPayload.html" target="_self">ITaskCreationPayload</a>, resultingFunction: <a href="../interfaces/IFunction.html" target="_self">IFunction</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="185"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:185</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>taskCreationData</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self" >ITaskCreationFormGroupValue</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>taskCreationPayload</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationPayload.html" target="_self" >ITaskCreationPayload</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>resultingFunction</td>
                                    <td>
                                                <code><a href="../interfaces/IFunction.html" target="_self" >IFunction</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_handleErrorGatewayConfiguration"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>_handleErrorGatewayConfiguration</b></span>
                        <a href="#_handleErrorGatewayConfiguration"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_handleErrorGatewayConfiguration(taskCreationPayload: <a href="../interfaces/ITaskCreationPayload.html" target="_self">ITaskCreationPayload</a>, resultingFunction: <a href="../interfaces/IFunction.html" target="_self">IFunction</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="213"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:213</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>taskCreationPayload</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationPayload.html" target="_self" >ITaskCreationPayload</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>resultingFunction</td>
                                    <td>
                                                <code><a href="../interfaces/IFunction.html" target="_self" >IFunction</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>{ gatewayShape: any; }</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_handleFunctionOutputParam"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>_handleFunctionOutputParam</b></span>
                        <a href="#_handleFunctionOutputParam"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_handleFunctionOutputParam(taskCreationData: <a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self">ITaskCreationFormGroupValue</a>, taskCreationPayload: <a href="../interfaces/ITaskCreationPayload.html" target="_self">ITaskCreationPayload</a>, outputParam: <a href="../interfaces/IParam.html" target="_self">IParam</a>, methodEvaluation?: <a href="../interfaces/IMethodEvaluationResult.html" target="_self">IMethodEvaluationResult</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="342"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:342</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>taskCreationData</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self" >ITaskCreationFormGroupValue</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>taskCreationPayload</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationPayload.html" target="_self" >ITaskCreationPayload</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>outputParam</td>
                                    <td>
                                                <code><a href="../interfaces/IParam.html" target="_self" >IParam</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>methodEvaluation</td>
                                    <td>
                                                <code><a href="../interfaces/IMethodEvaluationResult.html" target="_self" >IMethodEvaluationResult</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_handleNoFunctionSelected"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>_handleNoFunctionSelected</b></span>
                        <a href="#_handleNoFunctionSelected"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_handleNoFunctionSelected(taskCreationPayload: <a href="../interfaces/ITaskCreationPayload.html" target="_self">ITaskCreationPayload</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="253"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:253</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>taskCreationPayload</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationPayload.html" target="_self" >ITaskCreationPayload</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_methodEvaluationTypeToOutputType"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>_methodEvaluationTypeToOutputType</b></span>
                        <a href="#_methodEvaluationTypeToOutputType"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_methodEvaluationTypeToOutputType(element: <a href="../interfaces/IElement.html" target="_self">IElement</a>, methodEvaluation?: <a href="../interfaces/IMethodEvaluationResult.html" target="_self">IMethodEvaluationResult</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="396"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:396</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>element</td>
                                    <td>
                                                <code><a href="../interfaces/IElement.html" target="_self" >IElement</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>methodEvaluation</td>
                                    <td>
                                                <code><a href="../interfaces/IMethodEvaluationResult.html" target="_self" >IMethodEvaluationResult</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_outputParamInterface"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>_outputParamInterface</b></span>
                        <a href="#_outputParamInterface"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_outputParamInterface(methodEvaluation: <a href="../interfaces/IMethodEvaluationResult.html" target="_self">IMethodEvaluationResult</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="434"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:434</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>methodEvaluation</td>
                                    <td>
                                                <code><a href="../interfaces/IMethodEvaluationResult.html" target="_self" >IMethodEvaluationResult</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_outputParamValue"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>_outputParamValue</b></span>
                        <a href="#_outputParamValue"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_outputParamValue(methodEvaluation: <a href="../interfaces/IMethodEvaluationResult.html" target="_self">IMethodEvaluationResult</a>, defaultValue: object | null)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="477"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:477</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>methodEvaluation</td>
                                    <td>
                                                <code><a href="../interfaces/IMethodEvaluationResult.html" target="_self" >IMethodEvaluationResult</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>defaultValue</td>
                                    <td>
                                            <code>object | null</code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>null</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_removeActivityWhenNoFunctionIsReferenced"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>_removeActivityWhenNoFunctionIsReferenced</b></span>
                        <a href="#_removeActivityWhenNoFunctionIsReferenced"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_removeActivityWhenNoFunctionIsReferenced(configureActivity: <a href="../interfaces/IElement.html" target="_self">IElement | undefined</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="266"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:266</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>configureActivity</td>
                                    <td>
                                                <code><a href="../interfaces/IElement.html" target="_self" >IElement | undefined</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_updateBpmnModelElementActivityIdentifier"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>_updateBpmnModelElementActivityIdentifier</b></span>
                        <a href="#_updateBpmnModelElementActivityIdentifier"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>_updateBpmnModelElementActivityIdentifier(taskCreationPayload: <a href="../interfaces/ITaskCreationPayload.html" target="_self">ITaskCreationPayload</a>, referencedFunction: <a href="../interfaces/IFunction.html" target="_self">IFunction</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="502"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:502</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>taskCreationPayload</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationPayload.html" target="_self" >ITaskCreationPayload</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>referencedFunction</td>
                                    <td>
                                                <code><a href="../interfaces/IFunction.html" target="_self" >IFunction</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="applyTaskCreationConfig"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>applyTaskCreationConfig</b></span>
                        <a href="#applyTaskCreationConfig"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>applyTaskCreationConfig(taskCreationPayload: <a href="../interfaces/ITaskCreationPayload.html" target="_self">ITaskCreationPayload</a>, taskCreationData?: <a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self">ITaskCreationFormGroupValue</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="72"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:72</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>taskCreationPayload</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationPayload.html" target="_self" >ITaskCreationPayload</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>taskCreationData</td>
                                    <td>
                                                <code><a href="../interfaces/ITaskCreationFormGroupValue.html" target="_self" >ITaskCreationFormGroupValue</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="tryDeleteErrorGateway"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>tryDeleteErrorGateway</b></span>
                        <a href="#tryDeleteErrorGateway"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>tryDeleteErrorGateway(element: <a href="../interfaces/IElement.html" target="_self">IElement</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="145"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:145</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>element</td>
                                    <td>
                                                <code><a href="../interfaces/IElement.html" target="_self" >IElement</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="tryDeleteFunction"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>tryDeleteFunction</b></span>
                        <a href="#tryDeleteFunction"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>tryDeleteFunction(element: <a href="../interfaces/IElement.html" target="_self">IElement</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="167"
                            class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:167</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>element</td>
                                    <td>
                                                <code><a href="../interfaces/IElement.html" target="_self" >IElement</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="paramEditorDialogResultReceived$"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>paramEditorDialogResultReceived$</b></span>
                        <a href="#paramEditorDialogResultReceived$"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>this._bpmnJsService
    .bufferedDataObjectReferenceEditingEvents$
    .pipe(
      tap(result &#x3D;&gt; console.log(result))
    )</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="57" class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:57</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="taskEditingDialogResultReceived$"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>taskEditingDialogResultReceived$</b></span>
                        <a href="#taskEditingDialogResultReceived$"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>this._bpmnJsService
    .bufferedTaskEditingEvents$
    .pipe(
      switchMap((events) &#x3D;&gt; {
        const functionSelectionConfig &#x3D; events.find(event &#x3D;&gt; event.taskCreationStep &#x3D;&#x3D;&#x3D; TaskCreationStep.ConfigureFunctionSelection);
        const functionIdentifier &#x3D; BPMNJsRepository.getSLPBExtension&lt;number&gt;(functionSelectionConfig?.element?.businessObject, &#x27;ActivityExtension&#x27;, (ext) &#x3D;&gt; ext.activityFunctionId) ?? null;
        const taskCreationPayload &#x3D; {
          configureActivity: events.find(event &#x3D;&gt; event.taskCreationStep &#x3D;&#x3D;&#x3D; TaskCreationStep.ConfigureFunctionSelection)?.element,
          configureIncomingErrorGatewaySequenceFlow: events.find(event &#x3D;&gt; event.taskCreationStep &#x3D;&#x3D;&#x3D; TaskCreationStep.ConfigureErrorGatewayEntranceConnection)?.element
        } as ITaskCreationPayload, taskCreationFormGroupValue &#x3D; {
          functionIdentifier: functionIdentifier
        } as ITaskCreationFormGroupValue;

        return combineLatest([
          of(taskCreationPayload),
          this._dialogService.configTaskCreation({
            taskCreationFormGroupValue: taskCreationFormGroupValue,
            taskCreationPayload: taskCreationPayload
          })
        ]).pipe(
          map(([taskCreationPayload, taskCreationFormGroupValue]: [ITaskCreationPayload, ITaskCreationFormGroupValue]) &#x3D;&gt; ({ taskCreationPayload, taskCreationFormGroupValue }))
        );
      })
    )</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="32" class="link-to-prism">src/lib/process-builder/components/process-builder/process-builder-component.service.ts:32</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Inject, Injectable } from &#x27;@angular/core&#x27;;
import { BpmnJsService } from &#x27;../../services/bpmn-js.service&#x27;;
import { DialogService } from &#x27;../../services/dialog.service&#x27;;
import { combineLatest, tap, map, of, switchMap, shareReplay, firstValueFrom } from &#x27;rxjs&#x27;;
import { BPMNJsRepository } from &#x27;src/lib/core/bpmn-js.repository&#x27;;
import { TaskCreationStep } from &#x27;../../globals/task-creation-step&#x27;;
import { ITaskCreationPayload } from &#x27;../../interfaces/task-creation-payload.interface&#x27;;
import { IProcessBuilderConfig, PROCESS_BUILDER_CONFIG_TOKEN } from &#x27;../../interfaces/process-builder-config.interface&#x27;;
import { IConnector } from &#x27;src/lib/bpmn-io/interfaces/connector.interface&#x27;;
import { CodemirrorRepository } from &#x27;src/lib/core/codemirror.repository&#x27;;
import { selectSnapshot } from &#x27;../../globals/select-snapshot&#x27;;
import { Store } from &#x27;@ngrx/store&#x27;;
import defaultImplementation from &#x27;../../globals/default-implementation&#x27;;
import { IMethodEvaluationResult } from &#x27;../../interfaces/method-evaluation-result.interface&#x27;;
import { MethodEvaluationStatus } from &#x27;../../globals/method-evaluation-status&#x27;;
import { ProcessBuilderRepository } from &#x27;src/lib/core/process-builder-repository&#x27;;
import { removeIFunction, setIFunctionsCanFailFlag, upsertIFunction, upsertIParam } from &#x27;@process-builder/actions&#x27;;
import shapeTypes from &#x27;src/lib/bpmn-io/shape-types&#x27;;
import { IElement } from &#x27;src/lib/bpmn-io/interfaces/element.interface&#x27;;
import { deepObjectLookup } from &#x27;src/lib/shared/globals/deep-object-lookup.function&#x27;;
import { ConfirmationService } from &#x27;src/lib/confirmation/services/confirmation.service&#x27;;
import { ITaskCreationFormGroupValue } from &#x27;../../interfaces/task-creation-form-group-value.interface&#x27;;
import { IBpmnJS, IFunction, IInputParam, IParam, IParamDefinition } from &#x27;@process-builder/interfaces&#x27;;
import { BPMN_JS } from &#x27;@process-builder/injection&#x27;;
import { mapIParamsInterfaces } from &#x27;../../extensions/rxjs/map-params-interfaces.rxjs&#x27;;
import { mapIParamInterfaces } from &#x27;../../extensions/rxjs/map-param-interfaces.rxjs&#x27;;
import { selectIFunction, selectIFunctions, selectIInterface, selectIParam, selectIParams, selectIParamsByNormalizedName, selectNextFunctionIdentifier, selectNextParameterIdentifier } from &#x27;@process-builder/selectors&#x27;;

@Injectable()
export class ProcessBuilderComponentService {

  public taskEditingDialogResultReceived$ &#x3D; this._bpmnJsService
    .bufferedTaskEditingEvents$
    .pipe(
      switchMap((events) &#x3D;&gt; {
        const functionSelectionConfig &#x3D; events.find(event &#x3D;&gt; event.taskCreationStep &#x3D;&#x3D;&#x3D; TaskCreationStep.ConfigureFunctionSelection);
        const functionIdentifier &#x3D; BPMNJsRepository.getSLPBExtension&lt;number&gt;(functionSelectionConfig?.element?.businessObject, &#x27;ActivityExtension&#x27;, (ext) &#x3D;&gt; ext.activityFunctionId) ?? null;
        const taskCreationPayload &#x3D; {
          configureActivity: events.find(event &#x3D;&gt; event.taskCreationStep &#x3D;&#x3D;&#x3D; TaskCreationStep.ConfigureFunctionSelection)?.element,
          configureIncomingErrorGatewaySequenceFlow: events.find(event &#x3D;&gt; event.taskCreationStep &#x3D;&#x3D;&#x3D; TaskCreationStep.ConfigureErrorGatewayEntranceConnection)?.element
        } as ITaskCreationPayload, taskCreationFormGroupValue &#x3D; {
          functionIdentifier: functionIdentifier
        } as ITaskCreationFormGroupValue;

        return combineLatest([
          of(taskCreationPayload),
          this._dialogService.configTaskCreation({
            taskCreationFormGroupValue: taskCreationFormGroupValue,
            taskCreationPayload: taskCreationPayload
          })
        ]).pipe(
          map(([taskCreationPayload, taskCreationFormGroupValue]: [ITaskCreationPayload, ITaskCreationFormGroupValue]) &#x3D;&gt; ({ taskCreationPayload, taskCreationFormGroupValue }))
        );
      })
    );

  public paramEditorDialogResultReceived$ &#x3D; this._bpmnJsService
    .bufferedDataObjectReferenceEditingEvents$
    .pipe(
      tap(result &#x3D;&gt; console.log(result))
    );

  constructor(
    @Inject(BPMN_JS) private _bpmnJs: IBpmnJS,
    @Inject(PROCESS_BUILDER_CONFIG_TOKEN) private _config: IProcessBuilderConfig,
    private _dialogService: DialogService,
    private _bpmnJsService: BpmnJsService,
    private _store: Store,
    private _confirmationService: ConfirmationService
  ) { }

  public async applyTaskCreationConfig(taskCreationPayload: ITaskCreationPayload, taskCreationData?: ITaskCreationFormGroupValue) {
    if (!taskCreationData) {
      this._removeActivityWhenNoFunctionIsReferenced(taskCreationPayload.configureActivity);
      return;
    }

    let referencedFunction: IFunction | undefined | null, outputParam: IParam | undefined, gatewayShape: IElement | undefined;
    if (taskCreationData) {
      referencedFunction &#x3D; await selectSnapshot(this._store.select(selectIFunction(taskCreationData.functionIdentifier)));
    }

    const connector &#x3D; this._bpmnJsService.elementRegistryModule.get(taskCreationPayload.configureIncomingErrorGatewaySequenceFlow?.id ?? &#x27;&#x27;) as IConnector;
    if (connector) {
      if (taskCreationData?.entranceGatewayType) {
        if (taskCreationData.entranceGatewayType) {
          BPMNJsRepository.updateBpmnElementSLPBExtension(this._bpmnJs, connector.businessObject, &#x27;SequenceFlowExtension&#x27;, (ext) &#x3D;&gt; ext.sequenceFlowType &#x3D; taskCreationData.entranceGatewayType &#x3D;&#x3D;&#x3D; &#x27;Success&#x27; ? &#x27;success&#x27; : &#x27;error&#x27;);
          this._applyConnectorDefaultLabels(connector, taskCreationData);
        }
      } else {
        this._bpmnJsService.modelingModule.removeElements([connector]);
      }
    }

    if (!referencedFunction &amp;&amp; taskCreationPayload.configureActivity) {
      this._handleNoFunctionSelected(taskCreationPayload);
    }

    if (!referencedFunction) {
      return;
    }

    const nextParamId &#x3D; await selectSnapshot(this._store.select(selectNextParameterIdentifier()));
    const code &#x3D; taskCreationData.implementation ? taskCreationData.implementation.text : defaultImplementation;
    const methodEvaluation &#x3D; CodemirrorRepository.evaluateCustomMethod(undefined, code);

    if (referencedFunction.requireCustomImplementation || referencedFunction.customImplementation || taskCreationData.implementation) {
      referencedFunction &#x3D; await this._applyFunctionConfiguration(taskCreationData, referencedFunction, methodEvaluation, typeof referencedFunction.output &#x3D;&#x3D;&#x3D; &#x27;number&#x27; ? referencedFunction.output : nextParamId) as IFunction;
    }

    const resultingEndEvent &#x3D; taskCreationPayload.configureActivity?.outgoing?.find(outgoing &#x3D;&gt; outgoing.target.type &#x3D;&#x3D;&#x3D; &#x27;bpmn:EndEvent&#x27;)?.target;
    if (referencedFunction.finalizesFlow &amp;&amp; !resultingEndEvent) {
      this._appendSequenceFlowEndEvent(taskCreationPayload);
    } else if (!referencedFunction?.finalizesFlow &amp;&amp; resultingEndEvent) {
      this._bpmnJsService.modelingModule.removeElements([resultingEndEvent, ...resultingEndEvent.incoming]);
    }

    if (taskCreationPayload.configureActivity) {
      this._updateBpmnModelElementActivityIdentifier(taskCreationPayload, referencedFunction);

      if (typeof referencedFunction.output &#x3D;&#x3D;&#x3D; &#x27;number&#x27;) {
        outputParam &#x3D; (await selectSnapshot(this._store.select(selectIParam(referencedFunction.output)))) ?? { identifier: nextParamId } as IParam;
        const outputParamResult &#x3D; await this._handleFunctionOutputParam(taskCreationData, taskCreationPayload, outputParam, methodEvaluation);
        outputParam &#x3D; outputParamResult?.outputParam ?? outputParam;
      } else if (typeof referencedFunction.outputTemplate &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
        const iFace &#x3D; await selectSnapshot(this._store.select(selectIInterface(referencedFunction.outputTemplate)));
        outputParam &#x3D; { identifier: nextParamId, interface: iFace?.identifier, name: taskCreationData.outputParamName ?? iFace?.name, normalizedName: taskCreationData.normalizedOutputParamName ?? iFace?.normalizedName } as IParam;
        const outputParamResult &#x3D; await this._handleFunctionOutputParam(taskCreationData, taskCreationPayload, outputParam, methodEvaluation);
        outputParam &#x3D; outputParamResult?.outputParam ?? outputParam;
      }

      gatewayShape &#x3D; this._handleErrorGatewayConfiguration(taskCreationPayload, referencedFunction)?.gatewayShape;

      this._handleDataInputConfiguration(taskCreationData, taskCreationPayload, referencedFunction);
    }

    const effectedActivities &#x3D; this._bpmnJsService.elementRegistryModule.filter(element &#x3D;&gt; element.type &#x3D;&#x3D;&#x3D; shapeTypes.Task &amp;&amp; BPMNJsRepository.getSLPBExtension(element.businessObject, &#x27;ActivityExtension&#x27;, (ext &#x3D;&gt; ext.activityFunctionId)) &#x3D;&#x3D;&#x3D; referencedFunction?.identifier);
    for (const activity of effectedActivities) {
      this._bpmnJsService.modelingModule.updateLabel(activity, referencedFunction.name);
    }

    return { gatewayShape, outputParam };
  }

  public async tryDeleteErrorGateway(element: IElement) {
    const comingFromActivities &#x3D; element
      .incoming
      .filter(incoming &#x3D;&gt; incoming.type &#x3D;&#x3D;&#x3D; shapeTypes.SequenceFlow &amp;&amp; incoming.source.type &#x3D;&#x3D;&#x3D; shapeTypes.Task)
      .map(incoming &#x3D;&gt; incoming.source);

    const referencedFunctionIdentifiers &#x3D; comingFromActivities.map(activity &#x3D;&gt; BPMNJsRepository.getSLPBExtension(activity.businessObject, &#x27;ActivityExtension&#x27;, (ext) &#x3D;&gt; ext.activityFunctionId));
    const referencedFunctions &#x3D; await selectSnapshot(this._store.select(selectIFunctions(referencedFunctionIdentifiers)));

    const result &#x3D; await this._confirmationService.requestConfirmation(
      &#x60;${referencedFunctions.length &#x3D;&#x3D;&#x3D; 1 ? &#x27;One method&#x27; : referencedFunctions.length + &#x27; methods&#x27;} will be changed&#x60;,
      &#x60;By deleting that gateway, you will remove the &#x27;canFail&#x27;-flag from the methods listed below.&lt;ul&gt;${referencedFunctions.map(func &#x3D;&gt; &#x27;&lt;li&gt;&#x27; + func.normalizedName + &#x27;&lt;/li&gt;&#x27;)}&lt;/ul&gt;&lt;b&gt;Do you want to proceed?&lt;/b&gt;&#x60;
    );

    if (result) {
      const action &#x3D; setIFunctionsCanFailFlag({ funcs: referencedFunctionIdentifiers, canFail: false });
      this._store.dispatch(action);
      this._bpmnJsService.modelingModule.removeElements([element]);
      this._bpmnJsService.saveCurrentBpmnModel();
    }
  }

  public async tryDeleteFunction(element: IElement) {
    const referencedFunctionIdentifier &#x3D; BPMNJsRepository.getSLPBExtension(element.businessObject, &#x27;ActivityExtension&#x27;, (ext) &#x3D;&gt; ext.activityFunctionId);
    const func &#x3D; await selectSnapshot(this._store.select(selectIFunction(referencedFunctionIdentifier)));

    const result &#x3D; func?.customImplementation ? await this._confirmationService.requestConfirmation(
      &#x60;${func.normalizedName} will be deleted&#x60;,
      &#x60;By deleting that activity, you will remove the method &#x27;${func.normalizedName}&#x27;, all resulting parameters and all following gateways. That may break your pipeline!&lt;/br&gt;&lt;b&gt;Do you want to proceed?&lt;/b&gt;&#x60;
    ) : true;

    if (result) {
      this._bpmnJsService.removeOutgoingDataObjectReferences(element);
      this._bpmnJsService.removeOutgoingGateways(element);
      this._bpmnJsService.modelingModule.removeElements([element]);
      if (func?.customImplementation) this._store.dispatch(removeIFunction(func));
      this._bpmnJsService.saveCurrentBpmnModel();
    }
  }

  private _handleDataInputConfiguration(taskCreationData: ITaskCreationFormGroupValue, taskCreationPayload: ITaskCreationPayload, resultingFunction: IFunction) {
    const configureActivity &#x3D; taskCreationPayload.configureActivity;
    if (configureActivity) {
      const dataInputAssociations &#x3D; configureActivity.incoming.filter(incoming &#x3D;&gt; incoming.type &#x3D;&#x3D;&#x3D; shapeTypes.DataInputAssociation);
      if (dataInputAssociations.length &gt; 0) {
        this._bpmnJsService.modelingModule.removeElements(dataInputAssociations);
      }
    }

    if (resultingFunction.inputTemplates || resultingFunction.inputTemplates &#x3D;&#x3D;&#x3D; &#x27;dynamic&#x27;) {
      const inputParams &#x3D; Array.isArray(resultingFunction.inputTemplates) ? [...resultingFunction.inputTemplates] : [];
      if (typeof taskCreationData.inputParam &#x3D;&#x3D;&#x3D; &#x27;number&#x27;) {
        inputParams.push({ optional: false, interface: taskCreationData.interface ?? undefined, name: &#x27;my input&#x27;, type: &#x27;string&#x27; });
      }

      if (configureActivity) {
        const availableInputParamsIElements &#x3D; BPMNJsRepository.getAvailableInputParamsIElements(configureActivity);
        for (const param of inputParams.filter(inputParam &#x3D;&gt; !(taskCreationPayload.configureActivity as IElement).incoming.some(y &#x3D;&gt; BPMNJsRepository.sLPBExtensionSetted(y.source.businessObject, &#x27;DataObjectExtension&#x27;, (ext) &#x3D;&gt; ext.outputParam &#x3D;&#x3D;&#x3D; inputParam)))) {
          // HEREEE
          const element &#x3D; availableInputParamsIElements.find(x &#x3D;&gt; BPMNJsRepository.sLPBExtensionSetted(x.businessObject, &#x27;DataObjectExtension&#x27;, (ext) &#x3D;&gt; ext.outputParam &#x3D;&#x3D;&#x3D; param as IInputParam));
          if (element) {
            this._bpmnJsService.modelingModule.connect(element, configureActivity);
          }
        }
      }
    }
  }

  private _handleErrorGatewayConfiguration(taskCreationPayload: ITaskCreationPayload, resultingFunction: IFunction) {
    if (!taskCreationPayload.configureActivity) {
      return;
    }

    const outgoingErrorGatewaySequenceFlow &#x3D; taskCreationPayload
      .configureActivity
      .outgoing
      .find(sequenceFlow &#x3D;&gt; sequenceFlow.type &#x3D;&#x3D;&#x3D; shapeTypes.SequenceFlow &amp;&amp; sequenceFlow.target?.type &#x3D;&#x3D;&#x3D; shapeTypes.ExclusiveGateway);

    let gatewayShape &#x3D; outgoingErrorGatewaySequenceFlow?.target;

    if (resultingFunction.canFail &amp;&amp; !gatewayShape) {
      const outgoingSequenceFlows &#x3D; taskCreationPayload.configureActivity.outgoing.filter(outgoing &#x3D;&gt; outgoing.type &#x3D;&#x3D;&#x3D; shapeTypes.SequenceFlow);
      const formerConnectedTargets &#x3D; outgoingSequenceFlows.map(outgoingSequenceFlow &#x3D;&gt; outgoingSequenceFlow.target);
      this._bpmnJsService.modelingModule.removeElements(formerConnectedTargets);

      gatewayShape &#x3D; this._bpmnJsService.modelingModule.appendShape(
        taskCreationPayload.configureActivity,
        { type: shapeTypes.ExclusiveGateway },
        {
          x: taskCreationPayload.configureActivity.x + 200,
          y: taskCreationPayload.configureActivity.y + 40
        }
      );

      this._bpmnJsService.modelingModule.updateLabel(gatewayShape, this._config.errorGatewayConfig.gatewayName);

      // reconnect the former connected target as success action
      if (formerConnectedTargets[0]) {
        const connector &#x3D; this._bpmnJsService.modelingModule.connect(gatewayShape, formerConnectedTargets[0]);
        BPMNJsRepository.updateBpmnElementSLPBExtension(this._bpmnJs, connector.businessObject, &#x27;SequenceFlowExtension&#x27;, (ext) &#x3D;&gt; ext.sequenceFlowType &#x3D; &#x27;success&#x27;);
      }
    } else if (!resultingFunction.canFail &amp;&amp; gatewayShape) {
      this._bpmnJsService.modelingModule.removeElements([gatewayShape, ...gatewayShape.incoming, ...gatewayShape.outgoing]);
    }

    return { gatewayShape };
  }

  private _handleNoFunctionSelected(taskCreationPayload: ITaskCreationPayload) {
    const elements &#x3D; [taskCreationPayload.configureActivity].filter(element &#x3D;&gt; !!element) as (IElement | IConnector)[];
    this._bpmnJsService.modelingModule.removeElements(elements);
  }

  private _applyConnectorDefaultLabels(connector: IConnector, taskCreationData: ITaskCreationFormGroupValue) {
    const connectorLabel &#x3D; taskCreationData.entranceGatewayType &#x3D;&#x3D;&#x3D; &#x27;Success&#x27;
      ? this._config.errorGatewayConfig.successConnectionName
      : this._config.errorGatewayConfig.errorConnectionName;

    this._bpmnJsService.modelingModule.updateLabel(connector, connectorLabel)
  }

  private _removeActivityWhenNoFunctionIsReferenced(configureActivity: IElement | undefined) {
    if (!configureActivity) {
      return;
    }
    const activityFunctionId &#x3D; BPMNJsRepository.getSLPBExtension(configureActivity?.businessObject, &#x27;ActivityExtension&#x27;, (ext) &#x3D;&gt; ext.activityFunctionId);
    if (!activityFunctionId) {
      this._bpmnJsService.modelingModule.removeElements([configureActivity]);
    }
  }

  private async _applyFunctionConfiguration(taskCreationData: ITaskCreationFormGroupValue, referencedFunction: IFunction, methodEvaluation: IMethodEvaluationResult, outputParamId: number) {
    const inputParams &#x3D; await this._extractInputParams(taskCreationData, referencedFunction);
    const functionIdentifier &#x3D; referencedFunction.requireCustomImplementation ? await selectSnapshot(this._store.select(selectNextFunctionIdentifier())) : referencedFunction.identifier;
    const resultingFunction &#x3D; {
      customImplementation: taskCreationData.implementation?.text ?? undefined,
      canFail: taskCreationData.canFail ?? false,
      name: taskCreationData.name ?? this._config.defaultFunctionName,
      identifier: functionIdentifier,
      normalizedName: taskCreationData.normalizedName ?? ProcessBuilderRepository.normalizeName(taskCreationData.name ?? undefined),
      // here, I removed || referencedFunction.outputTemplate &#x3D;&#x3D;&#x3D; &#x27;dynamic&#x27;
      // functions may not provide any outputs
      output: methodEvaluation.status &#x3D;&#x3D;&#x3D; MethodEvaluationStatus.ReturnValueFound ? outputParamId : null,
      implementation: referencedFunction.implementation,
      inputTemplates: inputParams,
      requireCustomImplementation: false,
      requireDynamicInput: false,
      finalizesFlow: taskCreationData.isProcessOutput ?? false,
      requireStaticOutputDefinition: referencedFunction.requireStaticOutputDefinition
    } as IFunction;
    this._store.dispatch(upsertIFunction(resultingFunction));
    return resultingFunction;
  }

  private async _appendSequenceFlowEndEvent(taskCreationPayload: ITaskCreationPayload) {
    if (!taskCreationPayload.configureActivity) {
      return;
    }
    this._bpmnJsService.modelingModule.appendShape(taskCreationPayload.configureActivity, { type: shapeTypes.EndEvent }, {
      x: taskCreationPayload.configureActivity.x + 200,
      y: taskCreationPayload.configureActivity.y + 40
    });
  }

  private async _extractInputParams(taskCreationData: ITaskCreationFormGroupValue, referencedFunction: IFunction): Promise&lt;IInputParam[]&gt; {
    const inputParams: IInputParam[] &#x3D; [];
    if (referencedFunction.inputTemplates &#x3D;&#x3D;&#x3D; &#x27;dynamic&#x27; &amp;&amp; typeof taskCreationData.interface &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
      inputParams.push({ optional: false, interface: taskCreationData.interface, name: taskCreationData.normalizedName, type: &#x27;object&#x27; });
    }
    else if (referencedFunction.requireCustomImplementation || referencedFunction.customImplementation) {
      const usedInputParams: { varName: string, propertyName: string | null }[] &#x3D; taskCreationData.implementation
        ? CodemirrorRepository.getUsedInputParams(undefined, taskCreationData.implementation.text)
        : [];

      const usedInputParamEntities &#x3D; await selectSnapshot(
        this._store.select(
          selectIParamsByNormalizedName(
            usedInputParams.filter(
              usedInputParam &#x3D;&gt; usedInputParam.varName &#x3D;&#x3D;&#x3D; &#x27;injector&#x27;
                &amp;&amp; typeof usedInputParam.propertyName &#x3D;&#x3D;&#x3D; &#x27;string&#x27;
            ).map(usedInputParam &#x3D;&gt; usedInputParam.propertyName) as string[]
          )
        )
      );

      inputParams.push(...usedInputParamEntities.map((usedInputParamEntity) &#x3D;&gt; {
        return {
          optional: false,
          interface: typeof usedInputParamEntity.interface &#x3D;&#x3D;&#x3D; &#x27;number&#x27; ? usedInputParamEntity.interface : undefined,
          name: usedInputParamEntity.normalizedName,
          type: &#x27;object&#x27;
        } as IInputParam
      }));
    }
    return inputParams;
  }

  private async _handleFunctionOutputParam(taskCreationData: ITaskCreationFormGroupValue, taskCreationPayload: ITaskCreationPayload, outputParam: IParam, methodEvaluation?: IMethodEvaluationResult) {
    if (!taskCreationPayload.configureActivity) {
      return;
    }

    if (!methodEvaluation) {
      const code &#x3D; taskCreationData.implementation ? taskCreationData.implementation.text : defaultImplementation;
      methodEvaluation &#x3D; CodemirrorRepository.evaluateCustomMethod(undefined, code);
    }

    if (methodEvaluation.status &#x3D;&#x3D;&#x3D; MethodEvaluationStatus.ReturnValueFound || outputParam) {
      const paramInterface &#x3D; outputParam.interface ?? taskCreationData.interface ?? await this._outputParamInterface(methodEvaluation);
      const defaultValue &#x3D; !Array.isArray(taskCreationData.outputParamValue) &amp;&amp; taskCreationData.outputParamValue?.constant? taskCreationData.outputParamValue.defaultValue: outputParam.defaultValue ?? await this._outputParamValue(methodEvaluation, taskCreationData.outputParamValue);
      outputParam &#x3D; {
        ...outputParam,
        name: taskCreationData.outputParamName ?? outputParam.name ?? this._config.dynamicParamDefaultNaming,
        normalizedName: taskCreationData.normalizedOutputParamName ?? outputParam.normalizedName ?? ProcessBuilderRepository.normalizeName(taskCreationData.outputParamName ?? this._config.dynamicParamDefaultNaming),
        defaultValue: defaultValue,
        interface: paramInterface,
      } as IParam;
      if (!Array.isArray(taskCreationData.outputParamValue) &amp;&amp; taskCreationData.outputParamValue?.type &#x3D;&#x3D;&#x3D; &#x27;array&#x27;) {
        outputParam.interface &#x3D; null;
        outputParam.type &#x3D; &#x27;array&#x27;;
        outputParam.typeDef &#x3D; [
          {
            interface: paramInterface ?? null,
            type: &#x27;object&#x27;,
          } as IParamDefinition
        ]
      }
      if (typeof outputParam.interface &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
        outputParam.type &#x3D; &#x27;object&#x27;;
      } else {
        const outputType &#x3D; await this._methodEvaluationTypeToOutputType(taskCreationPayload.configureActivity, methodEvaluation);
        outputParam.type &#x3D; outputType;
      }

      this._store.dispatch(upsertIParam(outputParam));

      BPMNJsRepository.appendOutputParam(
        this._bpmnJs,
        taskCreationPayload.configureActivity,
        outputParam,
        true,
        this._config.expectInterface
      );

      return { outputParam }
    } else {
      const dataOutputAssociations &#x3D; taskCreationPayload.configureActivity.outgoing.filter(x &#x3D;&gt; x.type &#x3D;&#x3D;&#x3D; shapeTypes.DataOutputAssociation);
      this._bpmnJsService.modelingModule.removeElements(dataOutputAssociations.map(dataOutputAssociation &#x3D;&gt; dataOutputAssociation.target));
    }
  }

  private async _methodEvaluationTypeToOutputType(element: IElement, methodEvaluation?: IMethodEvaluationResult) {
    if (methodEvaluation?.injectorNavigationPath) {
      const inputParams &#x3D; await firstValueFrom(this._store.select(selectIParams(BPMNJsRepository.getAvailableInputParams(element))).pipe(
        shareReplay(1),
        map(inputParams &#x3D;&gt; inputParams ?? []),
        mapIParamsInterfaces(this._store)
      ));
      const currentPath &#x3D; methodEvaluation.injectorNavigationPath.split(&#x27;.&#x27;);
      let currentIndex &#x3D; 1;
      let param: IParam | IParamDefinition | undefined &#x3D; inputParams.find(param &#x3D;&gt; param.normalizedName &#x3D;&#x3D;&#x3D; currentPath[0]);
      while (currentIndex &lt; currentPath.length &amp;&amp; param &amp;&amp; Array.isArray(param.typeDef)) {
        param &#x3D; param.typeDef.find(param &#x3D;&gt; param.name &#x3D;&#x3D;&#x3D; currentPath[currentIndex]);
        currentIndex++;
      }

      if (param) {
        return param.type;
      }

      throw (&#x27;error&#x27;);
    }
    switch (methodEvaluation?.type) {
      case &#x27;number&#x27;:
        return &#x27;number&#x27;;

      case &#x27;string&#x27;:
        return &#x27;string&#x27;;

      case &#x27;boolean&#x27;:
        return &#x27;boolean&#x27;;

      case &#x27;array&#x27;:
        return &#x27;array&#x27;;
    }

    return &#x27;object&#x27;;
  }

  private async _outputParamInterface(methodEvaluation: IMethodEvaluationResult) {
    if (methodEvaluation.injectorNavigationPath) {
      const pathArray &#x3D; methodEvaluation.injectorNavigationPath?.split(&#x27;.&#x27;);
      const inputParam &#x3D; await firstValueFrom(this._store.select(selectIParams()).pipe(
        map(inputParams &#x3D;&gt; {
          const root &#x3D; pathArray[0];
          return (inputParams ?? []).find(inputParam &#x3D;&gt; inputParam.normalizedName &#x3D;&#x3D;&#x3D; root);
        }),
        mapIParamInterfaces(this._store)
      ));

      if (!inputParam) return;

      let currentIndex &#x3D; 1;
      let currentMember &#x3D; /^(.*).{0,1}\[(.*)\]/.exec(pathArray[currentIndex]);
      let currentMemberName &#x3D; currentMember?.[1] ?? null;
      let currentTypeDef &#x3D; (inputParam.typeDef as IParamDefinition[]).find(definition &#x3D;&gt; definition.name &#x3D;&#x3D;&#x3D; currentMemberName);

      while ((currentIndex + 1) &lt; pathArray.length ?? 0) {
        if (/^.+\(.*\)$/.test(pathArray[currentIndex])) {
          break;
        } else if (currentTypeDef?.type &#x3D;&#x3D;&#x3D; &#x27;array&#x27;) {
          if (typeof currentMember?.[2] &#x3D;&#x3D;&#x3D; &#x27;number&#x27;) {
            // array index
          } else {
            // array method/member call
            const call &#x3D; /^([a-zA-Z0-9]*).{0,1}\((.*)\)/.exec(pathArray.slice(currentIndex).join(&#x27;.&#x27;));
            const array: any &#x3D; ProcessBuilderRepository.createPseudoObjectFromIParam(currentTypeDef);
            const result &#x3D; call![2] ? &#x60;${array[call![1]]}(${call![2]})&#x60; : array[call![1]];
            debugger;
          }
        } else {
          currentIndex++;
          currentMember &#x3D; /^(.*).{0,1}\[(.*)\]/.exec(pathArray[currentIndex]);
          currentMemberName &#x3D; currentMember?.[1] ?? null;
          currentTypeDef &#x3D; (inputParam.typeDef as IParamDefinition[]).find(definition &#x3D;&gt; definition.name &#x3D;&#x3D;&#x3D; currentMemberName);
        }
      }

      return currentTypeDef?.interface;
    }
  }

  private async _outputParamValue(methodEvaluation: IMethodEvaluationResult, defaultValue: object | null &#x3D; null) {
    if (methodEvaluation.injectorNavigationPath) {
      const inputParam &#x3D; await firstValueFrom(this._store.select(selectIParams()).pipe(
        map(inputParams &#x3D;&gt; {
          const root &#x3D; methodEvaluation.injectorNavigationPath?.split(&#x27;.&#x27;)[0];
          return (inputParams ?? []).find(inputParam &#x3D;&gt; inputParam.normalizedName &#x3D;&#x3D;&#x3D; root);
        }),
        mapIParamInterfaces(this._store)
      ));
      const object &#x3D; ProcessBuilderRepository.createPseudoObjectFromIParam(inputParam);
      const injectedValue &#x3D; deepObjectLookup(object, methodEvaluation.injectorNavigationPath);
      return injectedValue;
    }
    switch (methodEvaluation.type) {
      case &#x27;number&#x27;:
      case &#x27;string&#x27;:
      case &#x27;object&#x27;:
      case &#x27;boolean&#x27;:
      case &#x27;array&#x27;:
        return methodEvaluation.detectedValue;
    }

    return defaultValue;
  }

  private _updateBpmnModelElementActivityIdentifier(taskCreationPayload: ITaskCreationPayload, referencedFunction: IFunction) {
    if (!taskCreationPayload.configureActivity) {
      return;
    }

    BPMNJsRepository.updateBpmnElementSLPBExtension(
      this._bpmnJs,
      taskCreationPayload.configureActivity.businessObject,
      &#x27;ActivityExtension&#x27;,
      (e) &#x3D;&gt; e.activityFunctionId &#x3D; referencedFunction.identifier
    );
  }

}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'ProcessBuilderComponentService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
